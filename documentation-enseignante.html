<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Documentation ‚Äî F√™te Express</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Biblioth√®ques pour PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
    <script src="firebase.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1a1f3a 50%, #0f172a 100%);
            color: #f1f5f9;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 30px;
            border-bottom: 2px solid rgba(99, 102, 241, 0.3);
        }
        
        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        
        .header p {
            color: #cbd5e1;
            font-size: 1.1rem;
        }
        
        .section {
            margin-bottom: 35px;
        }
        
        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #6366f1;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-content {
            background: rgba(15, 23, 42, 0.5);
            padding: 25px;
            border-radius: 16px;
            border-left: 4px solid #6366f1;
            line-height: 1.8;
        }
        
        .section-content p {
            margin-bottom: 15px;
            color: #e2e8f0;
        }
        
        .section-content ul {
            list-style: none;
            padding-left: 0;
        }
        
        .section-content li {
            padding: 10px 0;
            padding-left: 30px;
            position: relative;
            color: #e2e8f0;
        }
        
        .section-content li::before {
            content: "‚úì";
            position: absolute;
            left: 0;
            color: #6366f1;
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        .highlight-box {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.2) 0%, rgba(139, 92, 246, 0.2) 100%);
            border: 1px solid rgba(99, 102, 241, 0.3);
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
        }
        
        .btn-download {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: white;
            padding: 16px 32px;
            border-radius: 12px;
            border: none;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.4);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 100;
        }
        
        .btn-download:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 40px rgba(99, 102, 241, 0.6);
        }
        
        .btn-back {
            background: rgba(100, 116, 139, 0.3);
            color: white;
            padding: 12px 24px;
            border-radius: 10px;
            border: none;
            font-weight: 500;
            cursor: pointer;
            margin-bottom: 20px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }
        
        .btn-back:hover {
            background: rgba(100, 116, 139, 0.5);
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: #6366f1;
        }
        
        @media print {
            .btn-download, .btn-back {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div id="loadingScreen" style="display: flex; justify-content: center; align-items: center; min-height: 100vh;">
        <div style="text-align: center;">
            <div style="border: 4px solid rgba(99, 102, 241, 0.3); border-top: 4px solid #6366f1; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; margin: 0 auto 20px;"></div>
            <p style="color: #cbd5e1;">V√©rification de l'acc√®s...</p>
        </div>
    </div>
    
    <div id="content" style="display: none;">
        <div class="container" id="documentationContent">
            <button onclick="window.location.href='admin.html'" class="btn-back">
                <i data-lucide="arrow-left" class="w-5 h-5"></i>
                Retour √† l'administration
            </button>
            
            <div class="header">
                <h1>üìö Documentation F√™te Express</h1>
                <p>Guide simple pour l'enseignante</p>
            </div>
            
            <div class="section">
                <div class="section-title">
                    <i data-lucide="info" class="w-6 h-6"></i>
                    Qu'est-ce que F√™te Express ?
                </div>
                <div class="section-content">
                    <p><strong>F√™te Express</strong> est une plateforme web simple et amusante pour g√©rer et c√©l√©brer les anniversaires des √©l√®ves de votre classe.</p>
                    <p>Les √©l√®ves peuvent voir les anniversaires √† venir, envoyer des messages d'anniversaire, et participer √† des activit√©s amusantes.</p>
                </div>
            </div>
            
            <div class="section">
                <div class="section-title">
                    <i data-lucide="users" class="w-6 h-6"></i>
                    Les R√¥les dans le Syst√®me
                </div>
                <div class="section-content">
                    <ul>
                        <li><strong>√âl√®ve :</strong> Peut voir les anniversaires, envoyer des messages, et participer aux activit√©s</li>
                        <li><strong>Professeur :</strong> Peut g√©rer les anniversaires et voir les statistiques (comme vous)</li>
                        <li><strong>Admin :</strong> Acc√®s complet √† toutes les fonctionnalit√©s</li>
                        <li><strong>Comit√© :</strong> Peut organiser des activit√©s sp√©ciales</li>
                    </ul>
                </div>
            </div>
            
            <div class="section">
                <div class="section-title">
                    <i data-lucide="message-circle" class="w-6 h-6"></i>
                    Les Messages d'Anniversaire
                </div>
                <div class="section-content">
                    <p>Les √©l√®ves peuvent envoyer des messages d'anniversaire √† leurs camarades :</p>
                    <ul>
                        <li><strong>Messages secrets :</strong> Seulement visibles par la personne qui re√ßoit (tous les messages sont priv√©s)</li>
                    </ul>
                    <p>Les messages peuvent √™tre envoy√©s jusqu'√† 1 semaine avant l'anniversaire.</p>
                </div>
            </div>
            
            <div class="section">
                <div class="section-title">
                    <i data-lucide="target" class="w-6 h-6"></i>
                    Les D√©fis et Activit√©s
                </div>
                <div class="section-content">
                    <p>Le syst√®me propose des d√©fis amusants pour encourager la participation :</p>
                    
                    <div class="highlight-box" style="margin-top: 20px; margin-bottom: 20px;">
                        <p><strong>üéØ Le D√©fi de Progression (9 Personnes Cons√©cutives)</strong></p>
                        <p style="margin-top: 15px;"><strong>Comment √ßa marche concr√®tement :</strong></p>
                        <p>Les anniversaires sont class√©s par ordre chronologique (du plus proche au plus lointain).</p>
                        <p style="margin-top: 10px;"><strong>Exemple simple :</strong></p>
                        <p>Si les anniversaires sont :</p>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li>1. Marie (15 janvier)</li>
                            <li>2. Pierre (20 janvier)</li>
                            <li>3. Sophie (25 janvier)</li>
                            <li>4. Luc (1er f√©vrier)</li>
                            <li>... et ainsi de suite</li>
                        </ul>
                        <p style="margin-top: 15px;"><strong>L'objectif :</strong> Quand <strong>TOUS les √©l√®ves</strong> de la classe ont envoy√© un message √† une m√™me personne, le compteur augmente de 1.</p>
                        <p style="margin-top: 10px;"><strong>Ce qui se passe :</strong></p>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li>‚úÖ Si <strong>tous les √©l√®ves</strong> envoient un message √† Marie (1√®re personne) ‚Üí Le compteur passe √† 1</li>
                            <li>‚úÖ Si <strong>tous les √©l√®ves</strong> envoient ensuite un message √† Pierre (2√®me personne) ‚Üí Le compteur passe √† 2</li>
                            <li>‚úÖ Si <strong>tous les √©l√®ves</strong> envoient ensuite un message √† Sophie (3√®me personne) ‚Üí Le compteur passe √† 3</li>
                            <li>‚ùå Si une personne dans la s√©quence n'a <strong>pas re√ßu de message de tous les √©l√®ves</strong> ‚Üí Le compteur se r√©initialise √† z√©ro</li>
                            <li>üéâ Quand le compteur atteint 9 personnes cons√©cutives ‚Üí Le d√©fi est r√©ussi pour toute la classe !</li>
                            <li>üèÜ <strong>R√©compense :</strong> Quand 9 personnes cons√©cutives sont atteintes, les activit√©s sont gagn√©es !</li>
                        </ul>
                        <p style="margin-top: 15px;"><strong>Pourquoi ce d√©fi ?</strong></p>
                        <p>Cela encourage <strong>tous les √©l√®ves</strong> √† participer et √† ne pas oublier les anniversaires de leurs camarades. C'est un d√©fi collectif qui cr√©e de la coh√©sion dans la classe !</p>
                        <p style="margin-top: 10px;"><strong>üí° Important :</strong> Les activit√©s propos√©es dans le syst√®me sont d√©bloqu√©es et gagn√©es lorsque la classe atteint l'objectif de 9 personnes cons√©cutives. C'est une r√©compense collective pour toute la classe !</p>
                    </div>
                    
                    <p style="margin-top: 20px;"><strong>Autres activit√©s :</strong></p>
                    <ul>
                        <li><strong>Vote d'activit√©s :</strong> Les √©l√®ves peuvent voter pour les activit√©s qu'ils pr√©f√®rent</li>
                    </ul>
                </div>
            </div>
            
            <div class="section">
                <div class="section-title">
                    <i data-lucide="award" class="w-6 h-6"></i>
                    Syst√®me de R√©putation et Surveillance des Messages
                </div>
                <div class="section-content">
                    <p><strong>Le syst√®me de r√©putation :</strong></p>
                    <ul>
                        <li>Chaque √©l√®ve commence avec une <strong>r√©putation de 100/100</strong></li>
                        <li>La r√©putation refl√®te le comportement de l'√©l√®ve dans le syst√®me</li>
                        <li>Les comportements positifs maintiennent ou augmentent la r√©putation</li>
                        <li>Les comportements inappropri√©s r√©duisent automatiquement la r√©putation</li>
                    </ul>
                    
                    <div class="highlight-box" style="margin-top: 20px; margin-bottom: 20px;">
                        <p><strong>üîç Surveillance Automatique des Messages</strong></p>
                        <p style="margin-top: 15px;">Le syst√®me dispose d'un <strong>filtre automatique</strong> qui surveille tous les messages envoy√©s :</p>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li>‚úÖ <strong>Plus de 200 mots interdits</strong> sont d√©tect√©s automatiquement</li>
                            <li>‚úÖ Le filtre fonctionne m√™me si les √©l√®ves essaient de contourner (variations, accents, caract√®res sp√©ciaux, etc.)</li>
                            <li>‚úÖ Si un √©l√®ve essaie d'envoyer un message avec un mot interdit, le message est <strong>BLOQU√â</strong> et ne peut pas √™tre envoy√©</li>
                            <li>‚úÖ Le message bloqu√© est automatiquement enregistr√© dans un journal pour que vous puissiez le consulter</li>
                        </ul>
                    </div>

                    <p style="margin-top: 20px;"><strong>Cons√©quences en cas de message inappropri√© :</strong></p>
                    <ul>
                        <li>‚ùå <strong>Perte de 5 points de r√©putation</strong> √† chaque tentative d'envoi d'un message inappropri√©</li>
                        <li>üìù Le message est enregistr√© dans le journal des messages bloqu√©s (accessible dans le tableau de bord admin)</li>
                        <li>‚ö†Ô∏è <strong>Si la r√©putation tombe en dessous de 50/100</strong> : L'√©l√®ve ne peut plus envoyer de messages jusqu'√† ce que sa r√©putation remonte</li>
                        <li>üö´ <strong>Si la r√©putation tombe en dessous de 20/100</strong> : L'√©l√®ve risque de devenir "spectateur" et d'√™tre exclu des activit√©s et de la progression</li>
                    </ul>

                    <div class="highlight-box" style="margin-top: 20px; margin-bottom: 20px;">
                        <p><strong>üë®‚Äçüè´ Gestion par les Administrateurs</strong></p>
                        <p style="margin-top: 15px;">Dans le tableau de bord admin, vous pouvez :</p>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li>üìä <strong>Voir la r√©putation de chaque √©l√®ve</strong> dans la section "R√©putation & Statuts"</li>
                            <li>üîç <strong>Consulter tous les messages bloqu√©s</strong> avec les d√©tails (qui, quand, pourquoi)</li>
                            <li>‚úèÔ∏è <strong>Ajuster manuellement la r√©putation</strong> d'un √©l√®ve si n√©cessaire</li>
                            <li>üîì <strong>D√©bloquer un √©l√®ve</strong> ou modifier son statut (actif, bloqu√©, spectateur)</li>
                            <li>üìà <strong>Suivre l'historique</strong> des modifications de r√©putation</li>
                        </ul>
                    </div>

                    <p style="margin-top: 20px;"><strong>üí° Avantages du syst√®me :</strong></p>
                    <ul>
                        <li>üõ°Ô∏è <strong>Protection automatique 24h/24</strong> : Le syst√®me fonctionne en continu, sans intervention n√©cessaire</li>
                        <li>üìö <strong>P√©dagogique</strong> : Encourage les bons comportements et d√©courage les comportements inappropri√©s</li>
                        <li>‚öñÔ∏è <strong>√âquitable</strong> : Tous les √©l√®ves sont soumis aux m√™mes r√®gles</li>
                        <li>üîê <strong>S√©curis√©</strong> : Tous les messages sont valid√©s avant d'√™tre envoy√©s</li>
                    </ul>
                </div>
            </div>
            
            <div class="section">
                <div class="section-title">
                    <i data-lucide="shield" class="w-6 h-6"></i>
                    La S√©curit√© et la Confidentialit√©
                </div>
                <div class="section-content">
                    <ul>
                        <li>Tous les √©l√®ves doivent se connecter avec leur compte</li>
                        <li>Les messages sont mod√©r√©s et s√©curis√©s</li>
                        <li>Les professeurs et admins peuvent voir toutes les activit√©s</li>
                        <li>Les donn√©es sont stock√©es de mani√®re s√©curis√©e</li>
                    </ul>
                </div>
            </div>
            
            <div class="section">
                <div class="section-title">
                    <i data-lucide="settings" class="w-6 h-6"></i>
                    Param√®tres Importants
                </div>
                <div class="section-content">
                    <p><strong>Dans le tableau de bord admin, vous pouvez :</strong></p>
                    <ul>
                        <li>Voir tous les anniversaires de la classe</li>
                        <li>Ajouter, modifier ou supprimer des anniversaires</li>
                        <li>Voir les statistiques de participation</li>
                        <li>G√©rer les profils des √©l√®ves</li>
                        <li>Voir les messages envoy√©s (pour mod√©ration si n√©cessaire)</li>
                    </ul>
                </div>
            </div>
            
            <div class="section">
                <div class="section-title">
                    <i data-lucide="help-circle" class="w-6 h-6"></i>
                    Besoin d'Aide ?
                </div>
                <div class="section-content">
                    <p>Si vous avez des questions ou rencontrez un probl√®me :</p>
                    <ul>
                        <li>V√©rifiez que vous √™tes bien connect√©e avec votre compte professeur</li>
                        <li>Assurez-vous que les √©l√®ves ont bien compl√©t√© leur profil</li>
                        <li>Contactez l'administrateur technique si n√©cessaire</li>
                    </ul>
                    <div class="highlight-box">
                        <p><strong>‚ú® Rappel :</strong> Cette plateforme est con√ßue pour √™tre simple et intuitive. Si quelque chose semble compliqu√©, n'h√©sitez pas √† demander de l'aide !</p>
                    </div>
                </div>
            </div>
        </div>
        
        <button onclick="downloadPDF()" class="btn-download" id="btnDownload">
            <i data-lucide="download" class="w-5 h-5"></i>
            T√©l√©charger en PDF
        </button>
        
        <div id="loading" class="loading">
            <p>G√©n√©ration du PDF en cours...</p>
        </div>
    </div>
    
    <script>
        let currentUserId = null;
        let currentUserRole = null;
        
        // V√©rifier l'acc√®s
        async function checkAccess() {
            try {
                const user = firebase.auth().currentUser;
                if (!user) {
                    window.location.href = 'login.html';
                    return;
                }
                
                currentUserId = user.uid;
                
                // R√©cup√©rer le r√¥le de l'utilisateur
                const userDoc = await firebase.firestore().collection('users').doc(user.uid).get();
                if (!userDoc.exists) {
                    window.location.href = 'login.html';
                    return;
                }
                
                const userData = userDoc.data();
                currentUserRole = userData.role;
                
                // V√©rifier que l'utilisateur est admin ou professeur
                const isAdmin = currentUserRole === 'admin';
                const isProfessor = currentUserRole === 'professeur' || currentUserRole === 'teacher';
                
                if (!isAdmin && !isProfessor) {
                    alert('Acc√®s refus√©. Cette page est r√©serv√©e aux administrateurs et professeurs.');
                    window.location.href = 'eleve.html';
                    return;
                }
                
                // Afficher le contenu
                document.getElementById('loadingScreen').style.display = 'none';
                document.getElementById('content').style.display = 'block';
                lucide.createIcons();
                
            } catch (error) {
                console.error('Erreur lors de la v√©rification:', error);
                alert('Erreur lors de la v√©rification de l\'acc√®s.');
                window.location.href = 'login.html';
            }
        }
        
        // T√©l√©charger en PDF
        async function downloadPDF() {
            const btnDownload = document.getElementById('btnDownload');
            const loading = document.getElementById('loading');
            
            btnDownload.style.display = 'none';
            loading.style.display = 'block';
            
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF({
                    orientation: 'portrait',
                    unit: 'mm',
                    format: 'a4'
                });
                
                // Configuration
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                const margin = 20;
                const maxWidth = pageWidth - (margin * 2);
                let yPosition = margin;
                
                // Fonction pour ajouter une nouvelle page si n√©cessaire
                function checkNewPage(requiredHeight) {
                    if (yPosition + requiredHeight > pageHeight - margin) {
                        doc.addPage();
                        yPosition = margin;
                    }
                }
                
                // Titre principal
                doc.setFontSize(18);
                doc.setFont('helvetica', 'bold');
                doc.setTextColor(0, 0, 0);
                doc.text('Documentation F√™te Express', margin, yPosition);
                yPosition += 8;
                
                doc.setFontSize(12);
                doc.setFont('helvetica', 'normal');
                doc.text('Guide simple pour l\'enseignante', margin, yPosition);
                yPosition += 15;
                
                // Sections (sans emojis pour compatibilit√© PDF)
                const sections = [
                    {
                        title: 'Qu\'est-ce que F√™te Express ?',
                        content: [
                            'F√™te Express est une plateforme web simple et amusante pour g√©rer et c√©l√©brer les anniversaires des √©l√®ves de votre classe.',
                            'Les √©l√®ves peuvent voir les anniversaires √† venir, envoyer des messages d\'anniversaire, et participer √† des activit√©s amusantes.'
                        ]
                    },
                    {
                        title: 'Les R√¥les dans le Syst√®me',
                        content: [
                            '‚Ä¢ √âl√®ve : Peut voir les anniversaires, envoyer des messages, et participer aux activit√©s',
                            '‚Ä¢ Professeur : Peut g√©rer les anniversaires et voir les statistiques (comme vous)',
                            '‚Ä¢ Admin : Acc√®s complet √† toutes les fonctionnalit√©s',
                            '‚Ä¢ Comit√© : Peut organiser des activit√©s sp√©ciales'
                        ]
                    },
                    {
                        title: 'Les Messages d\'Anniversaire',
                        content: [
                            'Les √©l√®ves peuvent envoyer des messages d\'anniversaire √† leurs camarades :',
                            '‚Ä¢ Messages secrets : Seulement visibles par la personne qui re√ßoit (tous les messages sont priv√©s)',
                            '',
                            'Les messages peuvent √™tre envoy√©s jusqu\'√† 1 semaine avant l\'anniversaire.'
                        ]
                    },
                    {
                        title: 'Syst√®me de R√©putation et Surveillance des Messages',
                        content: [
                            'LE SYST√àME DE R√âPUTATION',
                            '',
                            'Chaque √©l√®ve commence avec une r√©putation de 100/100.',
                            'La r√©putation refl√®te le comportement de l\'√©l√®ve dans le syst√®me.',
                            'Les comportements positifs maintiennent ou augmentent la r√©putation.',
                            'Les comportements inappropri√©s r√©duisent automatiquement la r√©putation.',
                            '',
                            'SURVEILLANCE AUTOMATIQUE DES MESSAGES',
                            '',
                            'Le syst√®me dispose d\'un filtre automatique qui surveille tous les messages envoy√©s :',
                            '‚Ä¢ Plus de 200 mots interdits sont d√©tect√©s automatiquement',
                            '‚Ä¢ Le filtre fonctionne m√™me si les √©l√®ves essaient de contourner (variations, accents, caract√®res sp√©ciaux)',
                            '‚Ä¢ Si un √©l√®ve essaie d\'envoyer un message avec un mot interdit, le message est BLOQU√â',
                            '‚Ä¢ Le message bloqu√© est automatiquement enregistr√© dans un journal',
                            '',
                            'CONS√âQUENCES EN CAS DE MESSAGE INAPPROPRI√â',
                            '',
                            '‚Ä¢ Perte de 5 points de r√©putation √† chaque tentative d\'envoi d\'un message inappropri√©',
                            '‚Ä¢ Le message est enregistr√© dans le journal des messages bloqu√©s (accessible dans le tableau de bord admin)',
                            '‚Ä¢ Si la r√©putation tombe en dessous de 50/100 : L\'√©l√®ve ne peut plus envoyer de messages',
                            '‚Ä¢ Si la r√©putation tombe en dessous de 20/100 : L\'√©l√®ve risque de devenir "spectateur"',
                            '',
                            'GESTION PAR LES ADMINISTRATEURS',
                            '',
                            'Dans le tableau de bord admin, vous pouvez :',
                            '‚Ä¢ Voir la r√©putation de chaque √©l√®ve dans la section "R√©putation & Statuts"',
                            '‚Ä¢ Consulter tous les messages bloqu√©s avec les d√©tails (qui, quand, pourquoi)',
                            '‚Ä¢ Ajuster manuellement la r√©putation d\'un √©l√®ve si n√©cessaire',
                            '‚Ä¢ D√©bloquer un √©l√®ve ou modifier son statut (actif, bloqu√©, spectateur)',
                            '‚Ä¢ Suivre l\'historique des modifications de r√©putation',
                            '',
                            'AVANTAGES DU SYST√àME',
                            '',
                            '‚Ä¢ Protection automatique 24h/24 : Le syst√®me fonctionne en continu',
                            '‚Ä¢ P√©dagogique : Encourage les bons comportements',
                            '‚Ä¢ √âquitable : Tous les √©l√®ves sont soumis aux m√™mes r√®gles',
                            '‚Ä¢ S√©curis√© : Tous les messages sont valid√©s avant d\'√™tre envoy√©s'
                        ]
                    },
                    {
                        title: 'Les D√©fis et Activit√©s',
                        content: [
                            'Le syst√®me propose des d√©fis amusants pour encourager la participation :',
                            '',
                            'LE DEFI DE PROGRESSION (9 Personnes Cons√©cutives)',
                            '',
                            'Comment √ßa marche concr√®tement :',
                            'Les anniversaires sont class√©s par ordre chronologique (du plus proche au plus lointain).',
                            '',
                            'Exemple simple :',
                            'Si les anniversaires sont :',
                            '  1. Marie (15 janvier)',
                            '  2. Pierre (20 janvier)',
                            '  3. Sophie (25 janvier)',
                            '  4. Luc (1er f√©vrier)',
                            '  ... et ainsi de suite',
                            '',
                            'L\'objectif :',
                            'Quand TOUS les √©l√®ves de la classe ont envoy√© un message √† une m√™me personne, le compteur augmente de 1.',
                            '',
                            'Ce qui se passe :',
                            '  ‚úì Si tous les √©l√®ves envoient un message √† Marie (1√®re personne), le compteur passe √† 1',
                            '  ‚úì Si tous les √©l√®ves envoient ensuite un message √† Pierre (2√®me personne), le compteur passe √† 2',
                            '  ‚úì Si tous les √©l√®ves envoient ensuite un message √† Sophie (3√®me personne), le compteur passe √† 3',
                            '  ‚úó Si une personne dans la s√©quence n\'a pas re√ßu de message de tous les √©l√®ves, le compteur se r√©initialise √† z√©ro',
                            '  ‚úì Quand le compteur atteint 9 personnes cons√©cutives, le d√©fi est r√©ussi pour toute la classe',
                            '  ‚úì R√©compense : Quand 9 personnes cons√©cutives sont atteintes, les activit√©s sont gagn√©es',
                            '',
                            'Pourquoi ce d√©fi ?',
                            'Cela encourage tous les √©l√®ves √† participer et √† ne pas oublier les anniversaires de leurs camarades. C\'est un d√©fi collectif qui cr√©e de la coh√©sion dans la classe !',
                            '',
                            'IMPORTANT :',
                            'Les activit√©s propos√©es dans le syst√®me sont d√©bloqu√©es et gagn√©es lorsque la classe atteint l\'objectif de 9 personnes cons√©cutives. C\'est une r√©compense collective pour toute la classe !',
                            '',
                            'Autres activit√©s :',
                            '‚Ä¢ Vote d\'activit√©s : Les √©l√®ves peuvent voter pour les activit√©s qu\'ils pr√©f√®rent'
                        ]
                    },
                    {
                        title: 'La S√©curit√© et la Confidentialit√©',
                        content: [
                            '‚Ä¢ Tous les √©l√®ves doivent se connecter avec leur compte',
                            '‚Ä¢ Les messages sont mod√©r√©s et s√©curis√©s',
                            '‚Ä¢ Les professeurs et admins peuvent voir toutes les activit√©s',
                            '‚Ä¢ Les donn√©es sont stock√©es de mani√®re s√©curis√©e'
                        ]
                    },
                    {
                        title: 'Param√®tres Importants',
                        content: [
                            'Dans le tableau de bord admin, vous pouvez :',
                            '‚Ä¢ Voir tous les anniversaires de la classe',
                            '‚Ä¢ Ajouter, modifier ou supprimer des anniversaires',
                            '‚Ä¢ Voir les statistiques de participation',
                            '‚Ä¢ G√©rer les profils des √©l√®ves',
                            '‚Ä¢ Voir les messages envoy√©s (pour mod√©ration si n√©cessaire)'
                        ]
                    },
                    {
                        title: 'Besoin d\'Aide ?',
                        content: [
                            'Si vous avez des questions ou rencontrez un probl√®me :',
                            '‚Ä¢ V√©rifiez que vous √™tes bien connect√©e avec votre compte professeur',
                            '‚Ä¢ Assurez-vous que les √©l√®ves ont bien compl√©t√© leur profil',
                            '‚Ä¢ Contactez l\'administrateur technique si n√©cessaire',
                            '',
                            'RAPPEL : Cette plateforme est con√ßue pour √™tre simple et intuitive. Si quelque chose semble compliqu√©, n\'h√©sitez pas √† demander de l\'aide !'
                        ]
                    }
                ];
                
                // Ajouter chaque section
                sections.forEach((section, index) => {
                    checkNewPage(20);
                    
                    // Espace avant la section
                    if (index > 0) {
                        yPosition += 10;
                    }
                    
                    // Titre de section
                    doc.setFontSize(14);
                    doc.setFont('helvetica', 'bold');
                    doc.setTextColor(0, 0, 0);
                    const titleLines = doc.splitTextToSize(section.title, maxWidth);
                    titleLines.forEach(line => {
                        checkNewPage(8);
                        doc.text(line, margin, yPosition);
                        yPosition += 7;
                    });
                    yPosition += 5;
                    
                    // Contenu
                    doc.setFontSize(11);
                    doc.setFont('helvetica', 'normal');
                    doc.setTextColor(0, 0, 0);
                    
                    section.content.forEach(line => {
                        const trimmedLine = line.trim();
                        
                        if (trimmedLine === '') {
                            yPosition += 5;
                            return;
                        }
                        
                        checkNewPage(8);
                        
                        // Nettoyer le texte
                        let cleanText = trimmedLine.replace(/‚Üí/g, '->');
                        
                        const textLines = doc.splitTextToSize(cleanText, maxWidth);
                        textLines.forEach(l => {
                            checkNewPage(7);
                            doc.text(l, margin, yPosition);
                            yPosition += 7;
                        });
                    });
                });
                
                // Pied de page
                const pageCount = doc.internal.getNumberOfPages();
                for (let i = 1; i <= pageCount; i++) {
                    doc.setPage(i);
                    doc.setFontSize(9);
                    doc.setTextColor(100, 100, 100);
                    doc.setFont('helvetica', 'normal');
                    doc.text(
                        `Page ${i} sur ${pageCount}`,
                        pageWidth / 2,
                        pageHeight - 10,
                        { align: 'center' }
                    );
                }
                
                // Enregistrer le PDF
                doc.save('Documentation-Fete-Express.pdf');
                
            } catch (error) {
                console.error('Erreur lors de la g√©n√©ration du PDF:', error);
                alert('Erreur lors de la g√©n√©ration du PDF. Veuillez r√©essayer.');
            } finally {
                btnDownload.style.display = 'flex';
                loading.style.display = 'none';
            }
        }
        
        // V√©rifier l'acc√®s au chargement
        firebase.auth().onAuthStateChanged((user) => {
            if (user) {
                checkAccess();
            } else {
                window.location.href = 'login.html';
            }
        });
    </script>
</body>
</html>


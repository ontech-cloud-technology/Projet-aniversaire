<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Documentation ‚Äî F√™te Express</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Biblioth√®ques pour PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
    <script src="firebase.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1a1f3a 50%, #0f172a 100%);
            color: #f1f5f9;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 30px;
            border-bottom: 2px solid rgba(99, 102, 241, 0.3);
        }
        
        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        
        .header p {
            color: #cbd5e1;
            font-size: 1.1rem;
        }
        
        .section {
            margin-bottom: 35px;
        }
        
        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #6366f1;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-content {
            background: rgba(15, 23, 42, 0.5);
            padding: 25px;
            border-radius: 16px;
            border-left: 4px solid #6366f1;
            line-height: 1.8;
        }
        
        .section-content p {
            margin-bottom: 15px;
            color: #e2e8f0;
        }
        
        .section-content ul {
            list-style: none;
            padding-left: 0;
        }
        
        .section-content li {
            padding: 10px 0;
            padding-left: 30px;
            position: relative;
            color: #e2e8f0;
        }
        
        .section-content li::before {
            content: "‚úì";
            position: absolute;
            left: 0;
            color: #6366f1;
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        .highlight-box {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.2) 0%, rgba(139, 92, 246, 0.2) 100%);
            border: 1px solid rgba(99, 102, 241, 0.3);
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
        }
        
        .btn-download {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: white;
            padding: 16px 32px;
            border-radius: 12px;
            border: none;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.4);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 100;
        }
        
        .btn-download:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 40px rgba(99, 102, 241, 0.6);
        }
        
        .btn-back {
            background: rgba(100, 116, 139, 0.3);
            color: white;
            padding: 12px 24px;
            border-radius: 10px;
            border: none;
            font-weight: 500;
            cursor: pointer;
            margin-bottom: 20px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }
        
        .btn-back:hover {
            background: rgba(100, 116, 139, 0.5);
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: #6366f1;
        }
        
        @media print {
            .btn-download, .btn-back {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div id="loadingScreen" style="display: flex; justify-content: center; align-items: center; min-height: 100vh;">
        <div style="text-align: center;">
            <div style="border: 4px solid rgba(99, 102, 241, 0.3); border-top: 4px solid #6366f1; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; margin: 0 auto 20px;"></div>
            <p style="color: #cbd5e1;">V√©rification de l'acc√®s...</p>
        </div>
    </div>
    
    <div id="content" style="display: none;">
        <div class="container" id="documentationContent">
            <button onclick="window.location.href='admin.html'" class="btn-back">
                <i data-lucide="arrow-left" class="w-5 h-5"></i>
                Retour √† l'administration
            </button>
            
            <div class="header">
                <h1>üìö Documentation F√™te Express</h1>
                <p>Guide simple pour l'enseignante</p>
            </div>
            
            <div class="section">
                <div class="section-title">
                    <i data-lucide="info" class="w-6 h-6"></i>
                    Qu'est-ce que F√™te Express ?
                </div>
                <div class="section-content">
                    <p><strong>F√™te Express</strong> est une plateforme web simple et amusante pour g√©rer et c√©l√©brer les anniversaires des √©l√®ves de votre classe.</p>
                    <p>Les √©l√®ves peuvent voir les anniversaires √† venir, envoyer des messages d'anniversaire, et participer √† des activit√©s amusantes.</p>
                </div>
            </div>
            
            <div class="section">
                <div class="section-title">
                    <i data-lucide="users" class="w-6 h-6"></i>
                    Les R√¥les dans le Syst√®me
                </div>
                <div class="section-content">
                    <ul>
                        <li><strong>√âl√®ve :</strong> Peut voir les anniversaires, envoyer des messages, et participer aux activit√©s</li>
                        <li><strong>Professeur :</strong> Peut g√©rer les anniversaires et voir les statistiques (comme vous)</li>
                        <li><strong>Admin :</strong> Acc√®s complet √† toutes les fonctionnalit√©s</li>
                        <li><strong>Comit√© :</strong> Peut organiser des activit√©s sp√©ciales</li>
                    </ul>
                </div>
            </div>
            
            <div class="section">
                <div class="section-title">
                    <i data-lucide="calendar" class="w-6 h-6"></i>
                    G√©rer les Anniversaires
                </div>
                <div class="section-content">
                    <p><strong>Comment ajouter un anniversaire :</strong></p>
                    <ul>
                        <li>Allez dans la section "C√©l√©brations" du tableau de bord</li>
                        <li>Cliquez sur "Ajouter une c√©l√©bration"</li>
                        <li>Remplissez le nom de l'√©l√®ve et sa date d'anniversaire</li>
                        <li>Cliquez sur "Enregistrer"</li>
                    </ul>
                    <div class="highlight-box">
                        <p><strong>üí° Astuce :</strong> Vous pouvez importer plusieurs anniversaires en une fois en utilisant un fichier Excel !</p>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <div class="section-title">
                    <i data-lucide="message-circle" class="w-6 h-6"></i>
                    Les Messages d'Anniversaire
                </div>
                <div class="section-content">
                    <p>Les √©l√®ves peuvent envoyer des messages d'anniversaire √† leurs camarades :</p>
                    <ul>
                        <li><strong>Messages publics :</strong> Visibles par tout le monde</li>
                        <li><strong>Messages secrets :</strong> Seulement visibles par la personne qui re√ßoit</li>
                    </ul>
                    <p>Les messages peuvent √™tre envoy√©s jusqu'√† 1 semaine avant l'anniversaire.</p>
                </div>
            </div>
            
            <div class="section">
                <div class="section-title">
                    <i data-lucide="target" class="w-6 h-6"></i>
                    Les D√©fis et Activit√©s
                </div>
                <div class="section-content">
                    <p>Le syst√®me propose des d√©fis amusants pour encourager la participation :</p>
                    <ul>
                        <li><strong>D√©fi de progression :</strong> Les √©l√®ves essaient d'envoyer des messages √† 9 personnes cons√©cutives</li>
                        <li><strong>Vote d'activit√©s :</strong> Les √©l√®ves peuvent voter pour les activit√©s qu'ils pr√©f√®rent</li>
                    </ul>
                </div>
            </div>
            
            <div class="section">
                <div class="section-title">
                    <i data-lucide="shield" class="w-6 h-6"></i>
                    La S√©curit√© et la Confidentialit√©
                </div>
                <div class="section-content">
                    <ul>
                        <li>Tous les √©l√®ves doivent se connecter avec leur compte</li>
                        <li>Les messages sont mod√©r√©s et s√©curis√©s</li>
                        <li>Les professeurs et admins peuvent voir toutes les activit√©s</li>
                        <li>Les donn√©es sont stock√©es de mani√®re s√©curis√©e</li>
                    </ul>
                </div>
            </div>
            
            <div class="section">
                <div class="section-title">
                    <i data-lucide="settings" class="w-6 h-6"></i>
                    Param√®tres Importants
                </div>
                <div class="section-content">
                    <p><strong>Dans le tableau de bord admin, vous pouvez :</strong></p>
                    <ul>
                        <li>Voir tous les anniversaires de la classe</li>
                        <li>Ajouter, modifier ou supprimer des anniversaires</li>
                        <li>Voir les statistiques de participation</li>
                        <li>G√©rer les profils des √©l√®ves</li>
                        <li>Voir les messages envoy√©s (pour mod√©ration si n√©cessaire)</li>
                    </ul>
                </div>
            </div>
            
            <div class="section">
                <div class="section-title">
                    <i data-lucide="help-circle" class="w-6 h-6"></i>
                    Besoin d'Aide ?
                </div>
                <div class="section-content">
                    <p>Si vous avez des questions ou rencontrez un probl√®me :</p>
                    <ul>
                        <li>V√©rifiez que vous √™tes bien connect√©e avec votre compte professeur</li>
                        <li>Assurez-vous que les √©l√®ves ont bien compl√©t√© leur profil</li>
                        <li>Contactez l'administrateur technique si n√©cessaire</li>
                    </ul>
                    <div class="highlight-box">
                        <p><strong>‚ú® Rappel :</strong> Cette plateforme est con√ßue pour √™tre simple et intuitive. Si quelque chose semble compliqu√©, n'h√©sitez pas √† demander de l'aide !</p>
                    </div>
                </div>
            </div>
        </div>
        
        <button onclick="downloadPDF()" class="btn-download" id="btnDownload">
            <i data-lucide="download" class="w-5 h-5"></i>
            T√©l√©charger en PDF
        </button>
        
        <div id="loading" class="loading">
            <p>G√©n√©ration du PDF en cours...</p>
        </div>
    </div>
    
    <script>
        let currentUserId = null;
        let currentUserRole = null;
        
        // V√©rifier l'acc√®s
        async function checkAccess() {
            try {
                const user = firebase.auth().currentUser;
                if (!user) {
                    window.location.href = 'login.html';
                    return;
                }
                
                currentUserId = user.uid;
                
                // R√©cup√©rer le r√¥le de l'utilisateur
                const userDoc = await firebase.firestore().collection('users').doc(user.uid).get();
                if (!userDoc.exists) {
                    window.location.href = 'login.html';
                    return;
                }
                
                const userData = userDoc.data();
                currentUserRole = userData.role;
                
                // V√©rifier que l'utilisateur est admin ou professeur
                const isAdmin = currentUserRole === 'admin';
                const isProfessor = currentUserRole === 'professeur' || currentUserRole === 'teacher';
                
                if (!isAdmin && !isProfessor) {
                    alert('Acc√®s refus√©. Cette page est r√©serv√©e aux administrateurs et professeurs.');
                    window.location.href = 'eleve.html';
                    return;
                }
                
                // Afficher le contenu
                document.getElementById('loadingScreen').style.display = 'none';
                document.getElementById('content').style.display = 'block';
                lucide.createIcons();
                
            } catch (error) {
                console.error('Erreur lors de la v√©rification:', error);
                alert('Erreur lors de la v√©rification de l\'acc√®s.');
                window.location.href = 'login.html';
            }
        }
        
        // T√©l√©charger en PDF
        async function downloadPDF() {
            const btnDownload = document.getElementById('btnDownload');
            const loading = document.getElementById('loading');
            
            btnDownload.style.display = 'none';
            loading.style.display = 'block';
            
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF({
                    orientation: 'portrait',
                    unit: 'mm',
                    format: 'a4'
                });
                
                // Configuration
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                const margin = 20;
                const maxWidth = pageWidth - (margin * 2);
                let yPosition = margin;
                
                // Fonction pour ajouter une nouvelle page si n√©cessaire
                function checkNewPage(requiredHeight) {
                    if (yPosition + requiredHeight > pageHeight - margin) {
                        doc.addPage();
                        yPosition = margin;
                    }
                }
                
                // Titre principal
                doc.setFontSize(24);
                doc.setTextColor(99, 102, 241);
                doc.setFont('helvetica', 'bold');
                doc.text('üìö Documentation F√™te Express', margin, yPosition);
                yPosition += 10;
                
                doc.setFontSize(14);
                doc.setTextColor(100, 116, 139);
                doc.setFont('helvetica', 'normal');
                doc.text('Guide simple pour l\'enseignante', margin, yPosition);
                yPosition += 15;
                
                // Sections
                const sections = [
                    {
                        title: 'Qu\'est-ce que F√™te Express ?',
                        content: [
                            'F√™te Express est une plateforme web simple et amusante pour g√©rer et c√©l√©brer les anniversaires des √©l√®ves de votre classe.',
                            'Les √©l√®ves peuvent voir les anniversaires √† venir, envoyer des messages d\'anniversaire, et participer √† des activit√©s amusantes.'
                        ]
                    },
                    {
                        title: 'Les R√¥les dans le Syst√®me',
                        content: [
                            '‚Ä¢ √âl√®ve : Peut voir les anniversaires, envoyer des messages, et participer aux activit√©s',
                            '‚Ä¢ Professeur : Peut g√©rer les anniversaires et voir les statistiques (comme vous)',
                            '‚Ä¢ Admin : Acc√®s complet √† toutes les fonctionnalit√©s',
                            '‚Ä¢ Comit√© : Peut organiser des activit√©s sp√©ciales'
                        ]
                    },
                    {
                        title: 'G√©rer les Anniversaires',
                        content: [
                            'Comment ajouter un anniversaire :',
                            '1. Allez dans la section "C√©l√©brations" du tableau de bord',
                            '2. Cliquez sur "Ajouter une c√©l√©bration"',
                            '3. Remplissez le nom de l\'√©l√®ve et sa date d\'anniversaire',
                            '4. Cliquez sur "Enregistrer"',
                            '',
                            'üí° Astuce : Vous pouvez importer plusieurs anniversaires en une fois en utilisant un fichier Excel !'
                        ]
                    },
                    {
                        title: 'Les Messages d\'Anniversaire',
                        content: [
                            'Les √©l√®ves peuvent envoyer des messages d\'anniversaire √† leurs camarades :',
                            '‚Ä¢ Messages publics : Visibles par tout le monde',
                            '‚Ä¢ Messages secrets : Seulement visibles par la personne qui re√ßoit',
                            '',
                            'Les messages peuvent √™tre envoy√©s jusqu\'√† 1 semaine avant l\'anniversaire.'
                        ]
                    },
                    {
                        title: 'Les D√©fis et Activit√©s',
                        content: [
                            'Le syst√®me propose des d√©fis amusants pour encourager la participation :',
                            '‚Ä¢ D√©fi de progression : Les √©l√®ves essaient d\'envoyer des messages √† 9 personnes cons√©cutives',
                            '‚Ä¢ Vote d\'activit√©s : Les √©l√®ves peuvent voter pour les activit√©s qu\'ils pr√©f√®rent'
                        ]
                    },
                    {
                        title: 'La S√©curit√© et la Confidentialit√©',
                        content: [
                            '‚Ä¢ Tous les √©l√®ves doivent se connecter avec leur compte',
                            '‚Ä¢ Les messages sont mod√©r√©s et s√©curis√©s',
                            '‚Ä¢ Les professeurs et admins peuvent voir toutes les activit√©s',
                            '‚Ä¢ Les donn√©es sont stock√©es de mani√®re s√©curis√©e'
                        ]
                    },
                    {
                        title: 'Param√®tres Importants',
                        content: [
                            'Dans le tableau de bord admin, vous pouvez :',
                            '‚Ä¢ Voir tous les anniversaires de la classe',
                            '‚Ä¢ Ajouter, modifier ou supprimer des anniversaires',
                            '‚Ä¢ Voir les statistiques de participation',
                            '‚Ä¢ G√©rer les profils des √©l√®ves',
                            '‚Ä¢ Voir les messages envoy√©s (pour mod√©ration si n√©cessaire)'
                        ]
                    },
                    {
                        title: 'Besoin d\'Aide ?',
                        content: [
                            'Si vous avez des questions ou rencontrez un probl√®me :',
                            '‚Ä¢ V√©rifiez que vous √™tes bien connect√©e avec votre compte professeur',
                            '‚Ä¢ Assurez-vous que les √©l√®ves ont bien compl√©t√© leur profil',
                            '‚Ä¢ Contactez l\'administrateur technique si n√©cessaire',
                            '',
                            '‚ú® Rappel : Cette plateforme est con√ßue pour √™tre simple et intuitive. Si quelque chose semble compliqu√©, n\'h√©sitez pas √† demander de l\'aide !'
                        ]
                    }
                ];
                
                // Ajouter chaque section
                sections.forEach((section, index) => {
                    checkNewPage(30);
                    
                    // Titre de section
                    doc.setFontSize(16);
                    doc.setTextColor(99, 102, 241);
                    doc.setFont('helvetica', 'bold');
                    doc.text(section.title, margin, yPosition);
                    yPosition += 10;
                    
                    // Contenu
                    doc.setFontSize(11);
                    doc.setTextColor(30, 41, 59);
                    doc.setFont('helvetica', 'normal');
                    
                    section.content.forEach(line => {
                        checkNewPage(8);
                        if (line.trim() !== '') {
                            const lines = doc.splitTextToSize(line, maxWidth);
                            lines.forEach(l => {
                                doc.text(l, margin, yPosition);
                                yPosition += 6;
                            });
                        } else {
                            yPosition += 4;
                        }
                    });
                    
                    yPosition += 5; // Espace entre sections
                });
                
                // Enregistrer le PDF
                doc.save('Documentation-Fete-Express.pdf');
                
            } catch (error) {
                console.error('Erreur lors de la g√©n√©ration du PDF:', error);
                alert('Erreur lors de la g√©n√©ration du PDF. Veuillez r√©essayer.');
            } finally {
                btnDownload.style.display = 'flex';
                loading.style.display = 'none';
            }
        }
        
        // V√©rifier l'acc√®s au chargement
        firebase.auth().onAuthStateChanged((user) => {
            if (user) {
                checkAccess();
            } else {
                window.location.href = 'login.html';
            }
        });
    </script>
</body>
</html>


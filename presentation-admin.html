<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìä</text></svg>" />
    <title>Pr√©sentation Admin ‚Äî F√™te Express</title>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="js/presentation-storage.js"></script>
    
    <style>
        :root {
            --bg: radial-gradient(circle at top left, #1a0f30, #0a041c);
            --glass: rgba(255, 255, 255, 0.04);
            --accent: linear-gradient(90deg, #ff6f61, #f9c74f);
            --primary: #ff6f61;
            --secondary: #f9c74f;
            --radius: 16px;
            --shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            --muted: #c8c8d4;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            height: 100vh;
            background: var(--bg);
            font-family: 'Manrope', sans-serif;
            color: #f1f5f9;
            overflow: auto;
        }

        /* √âcran de gestion */
        #managementScreen {
            min-height: 100vh;
            padding: 40px 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .management-container {
            width: 100%;
            max-width: 1200px;
        }

        .section-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(12px);
            border-radius: var(--radius);
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
        }

        h1 {
            font-weight: 800;
            font-size: 2.5em;
            margin-bottom: 10px;
            background: var(--accent);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-align: center;
        }

        h2 {
            font-weight: 600;
            font-size: 1.5em;
            margin-bottom: 20px;
            color: #fff;
        }

        .subtitle {
            text-align: center;
            color: var(--muted);
            margin-bottom: 30px;
        }

        input, select {
            width: 100%;
            padding: 14px;
            border-radius: 10px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            color: #fff;
            font-size: 16px;
            margin-bottom: 15px;
            transition: all 0.2s ease;
        }

        input:focus, select:focus {
            border-color: var(--primary);
            box-shadow: 0 0 12px rgba(255, 111, 97, 0.4);
            outline: none;
        }

        input[type="file"] {
            padding: 10px;
            cursor: pointer;
        }

        button {
            border: none;
            background: var(--accent);
            padding: 14px 24px;
            border-radius: 10px;
            color: #1a0f30;
            font-weight: 800;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(255, 111, 97, 0.4);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.2);
        }

        .btn-success {
            background: linear-gradient(90deg, #10b981, #059669);
            color: #fff;
        }

        .btn-danger {
            background: linear-gradient(90deg, #ef4444, #dc2626);
            color: #fff;
        }

        .error-message {
            color: #f87171;
            text-align: center;
            margin-top: 15px;
            font-size: 14px;
            padding: 10px;
            background: rgba(239, 68, 68, 0.1);
            border-radius: 8px;
            display: none;
        }

        .success-message {
            color: #10b981;
            text-align: center;
            margin-top: 15px;
            font-size: 14px;
            padding: 10px;
            background: rgba(16, 185, 129, 0.1);
            border-radius: 8px;
            display: none;
        }

        .presentation-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .presentation-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .presentation-item:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .presentation-item.selected {
            border-color: var(--primary);
            background: rgba(255, 111, 97, 0.1);
        }

        .presentation-item h3 {
            font-size: 1.2em;
            margin-bottom: 10px;
            color: #fff;
        }

        .presentation-item .status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            margin-top: 10px;
        }

        .status.ready {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }

        .status.pending {
            background: rgba(251, 191, 36, 0.2);
            color: #fbbf24;
        }

        .upload-area {
            border: 2px dashed rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }

        .upload-area:hover {
            border-color: var(--primary);
            background: rgba(255, 111, 97, 0.05);
        }

        .upload-area.dragover {
            border-color: var(--primary);
            background: rgba(255, 111, 97, 0.1);
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* √âcran de login */
        #loginScreen {
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg);
        }

        .login-card {
            width: 90%;
            max-width: 400px;
            padding: 40px;
            border-radius: var(--radius);
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(12px);
            box-shadow: var(--shadow);
        }

        /* √âcran de pr√©sentation */
        #presentationScreen {
            display: none;
            height: 100vh;
            flex-direction: column;
            background: #000;
            position: relative;
        }

        .presentation-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(26, 15, 48, 0.95);
            backdrop-filter: blur(10px);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .slide-counter {
            font-weight: 600;
            color: var(--muted);
        }

        .controls {
            display: flex;
            gap: 10px;
        }

        .control-btn {
            padding: 8px 16px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #fff;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: var(--primary);
        }

        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .exit-btn {
            background: rgba(239, 68, 68, 0.2);
            border-color: rgba(239, 68, 68, 0.4);
        }

        .exit-btn:hover {
            background: rgba(239, 68, 68, 0.3);
        }

        .presentation-screen.fullscreen .presentation-header {
            display: none;
        }

        .presentation-screen.fullscreen .keyboard-hint {
            display: none;
        }

        .presentation-screen.fullscreen .presentation-content {
            padding: 0;
            height: 100vh;
        }

        .presentation-screen.fullscreen .slide-image {
            max-height: 100vh;
            width: 100vw;
            object-fit: contain;
            border-radius: 0;
            cursor: pointer;
        }

        .presentation-content {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 80px 20px 20px;
            overflow: auto;
        }

        .slide-container {
            max-width: 100%;
            max-height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .slide-image {
            max-width: 100%;
            max-height: calc(100vh - 120px);
            object-fit: contain;
            border-radius: 8px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }

        .loading {
            text-align: center;
            color: var(--muted);
            font-size: 18px;
        }

        .no-slides {
            text-align: center;
            color: var(--muted);
            padding: 40px;
        }

        .no-slides h2 {
            margin-bottom: 20px;
            color: #fff;
        }

        .keyboard-hint {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 12px;
            color: var(--muted);
            z-index: 50;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #fff;
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
    </style>
</head>
<body>
    <!-- √âcran de Gestion -->
    <div id="managementScreen">
        <div class="management-container">
            <h1>üìä Gestion des Pr√©sentations</h1>
            <p class="subtitle">T√©l√©chargez et convertissez vos pr√©sentations PowerPoint</p>

            <!-- Section Upload -->
            <div class="section-card">
                <h2>üì§ T√©l√©charger une Pr√©sentation</h2>
                <div id="bucketSetupWarning" style="display: none; background: rgba(251, 191, 36, 0.1); border: 1px solid rgba(251, 191, 36, 0.3); border-radius: 8px; padding: 15px; margin-bottom: 20px;">
                    <div style="display: flex; align-items: start; gap: 10px;">
                        <i data-lucide="alert-triangle" style="width: 24px; height: 24px; color: #fbbf24; flex-shrink: 0;"></i>
                        <div style="flex: 1;">
                            <p style="color: #fbbf24; font-weight: 600; margin-bottom: 8px;">Bucket "presentations" non trouv√©</p>
                            <p style="color: var(--muted); font-size: 0.9em; margin-bottom: 10px;">
                                Le bucket doit √™tre cr√©√© avant de pouvoir uploader des fichiers.
                            </p>
                            <button onclick="createBucket()" id="createBucketBtn" class="btn-success" style="width: auto; padding: 8px 16px; font-size: 0.9em;">
                                <i data-lucide="plus-circle"></i>
                                Cr√©er le bucket automatiquement
                            </button>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>Nom de la pr√©sentation</label>
                    <input type="text" id="presentationName" placeholder="Ex: Pr√©sentation Anniversaire 2024" />
                </div>
                <div class="upload-area" id="uploadArea">
                    <i data-lucide="upload" style="width: 48px; height: 48px; margin: 0 auto 20px; color: var(--muted);"></i>
                    <p style="font-size: 1.1em; margin-bottom: 10px;">Glissez-d√©posez votre fichier PowerPoint ici</p>
                    <p style="color: var(--muted); font-size: 0.9em;">ou cliquez pour s√©lectionner</p>
                    <input type="file" id="pptxFile" accept=".pptx" style="display: none;" />
                </div>
                <div id="uploadStatus" class="error-message"></div>
                <button onclick="uploadPresentation()" id="uploadBtn" disabled>
                    <i data-lucide="upload"></i>
                    T√©l√©charger vers Supabase
                </button>
            </div>

            <!-- Section Pr√©sentations -->
            <div class="section-card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 style="margin: 0;">üìã Mes Pr√©sentations</h2>
                    <button onclick="diagnoseBucket()" class="btn-secondary" style="width: auto; padding: 8px 16px; font-size: 0.9em;">
                        <i data-lucide="search"></i>
                        Diagnostic
                    </button>
                </div>
                <div id="presentationsList" class="presentation-list">
                    <p style="text-align: center; color: var(--muted);">Chargement...</p>
                </div>
            </div>

            <!-- Section Conversion -->
            <div class="section-card">
                <h2>‚öôÔ∏è Conversion</h2>
                <p style="color: var(--muted); margin-bottom: 20px;">
                    S√©lectionnez une pr√©sentation ci-dessus, puis cliquez sur "Convertir" pour g√©n√©rer les images.
                </p>
                <div class="button-group">
                    <button onclick="convertPresentation()" id="convertBtn" disabled class="btn-success">
                        <i data-lucide="image"></i>
                        Convertir en Images
                    </button>
                    <button onclick="refreshPresentations()" class="btn-secondary">
                        <i data-lucide="refresh-cw"></i>
                        Actualiser
                    </button>
                </div>
                <div id="convertStatus" class="error-message"></div>
            </div>

            <!-- Section Pr√©sentation -->
            <div class="section-card">
                <h2>üéØ Lancer une Pr√©sentation</h2>
                <p style="color: var(--muted); margin-bottom: 20px;">
                    Affiche les images du dossier <code style="background: rgba(255,255,255,0.1); padding: 2px 6px; border-radius: 4px;">presentation-slides/Final/</code>
                </p>
                <button onclick="startPresentation()" id="startBtn" class="btn-success">
                    <i data-lucide="play"></i>
                    Lancer la Pr√©sentation
                </button>
            </div>
        </div>
    </div>

    <!-- √âcran de Login -->
    <div id="loginScreen" style="display: none;">
        <div class="login-card">
            <h1>üîê Acc√®s Pr√©sentation</h1>
            <p class="subtitle">Entrez le code d'acc√®s administrateur</p>
            <form onsubmit="event.preventDefault(); checkAccess();">
            <input 
                type="password" 
                id="accessCode" 
                placeholder="Code d'acc√®s"
                autocomplete="off"
                autofocus
            />
                <button type="submit">Acc√©der</button>
            </form>
            <div id="errorMessage" class="error-message">
                Code d'acc√®s incorrect
            </div>
        </div>
    </div>

    <!-- √âcran de Pr√©sentation -->
    <div id="presentationScreen" class="presentation-screen">
        <div class="presentation-header">
            <div class="slide-counter">
                <span id="currentSlide">1</span> / <span id="totalSlides">0</span>
            </div>
            <div class="controls">
                <button class="control-btn" onclick="previousSlide()" id="prevBtn">
                    <i data-lucide="chevron-left" class="w-4 h-4"></i>
                    Pr√©c√©dent
                </button>
                <button class="control-btn" onclick="nextSlide()" id="nextBtn">
                    Suivant
                    <i data-lucide="chevron-right" class="w-4 h-4"></i>
                </button>
                <button class="control-btn" onclick="toggleFullscreen()" id="fullscreenBtn">
                    <i data-lucide="maximize" class="w-4 h-4" id="fullscreenIcon"></i>
                    <span id="fullscreenText">Plein √©cran</span>
                </button>
                <button class="control-btn exit-btn" onclick="exitPresentation()">
                    <i data-lucide="x" class="w-4 h-4"></i>
                    Quitter
                </button>
            </div>
        </div>
        
        <div class="presentation-content">
            <div class="slide-container" id="slideContainer">
                <div class="loading">Chargement de la pr√©sentation...</div>
            </div>
        </div>

        <div class="keyboard-hint">
            Utilisez les fl√®ches ‚Üê ‚Üí pour naviguer, ou ESC pour quitter
        </div>
    </div>

    <script>
        // Configuration
        const ADMIN_ACCESS_CODE = '203ADMIN2024';
        const API_URL = 'http://localhost:5000'; // URL de l'API de conversion
        
        let presentationStorage = null;
        let currentSlideIndex = 0;
        let slides = [];
        let selectedPresentation = null;
        let presentations = [];

        // Initialisation
        document.addEventListener('DOMContentLoaded', async function() {
            // Afficher le code d'acc√®s dans la console
            console.log('%cüîê CODE D\'ACC√àS PR√âSENTATION', 'color: #ff6f61; font-size: 20px; font-weight: bold;');
            console.log('%c' + ADMIN_ACCESS_CODE, 'color: #f9c74f; font-size: 24px; font-weight: bold; padding: 10px; background: #1a0f30; border: 2px solid #ff6f61; border-radius: 8px;');
            console.log('%cUtilisez ce code pour acc√©der √† la pr√©sentation', 'color: #c8c8d4; font-size: 14px;');
            
            presentationStorage = new PresentationStorage();
            lucide.createIcons();
            
            // Setup upload area
            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.getElementById('pptxFile');
            
            uploadArea.addEventListener('click', () => fileInput.click());
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });
            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                if (e.dataTransfer.files.length > 0) {
                    fileInput.files = e.dataTransfer.files;
                    updateUploadButton();
                }
            });
            
            fileInput.addEventListener('change', updateUploadButton);
            document.getElementById('presentationName').addEventListener('input', updateUploadButton);
            
            // Entr√©e pour valider le login
            document.getElementById('accessCode')?.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    checkAccess();
                }
            });
            
            // V√©rifier si le bucket existe au chargement
            await checkBucketAndShowWarning();
            await refreshPresentations();
        });

        async function checkBucketAndShowWarning() {
            const bucketExists = await presentationStorage.checkBucketExists();
            const warningDiv = document.getElementById('bucketSetupWarning');
            
            if (!bucketExists) {
                warningDiv.style.display = 'block';
            } else {
                warningDiv.style.display = 'none';
            }
        }

        async function createBucket() {
            // Demander confirmation car on va utiliser la cl√© service_role
            const confirmed = confirm(
                '‚ö†Ô∏è ATTENTION S√âCURIT√â\n\n' +
                'La cr√©ation du bucket n√©cessite des permissions administrateur.\n\n' +
                'Cette op√©ration utilisera temporairement la cl√© service_role.\n\n' +
                'Continuer ?'
            );
            
            if (!confirmed) return;
            
            const createBtn = document.getElementById('createBucketBtn');
            const originalText = createBtn.innerHTML;
            
            createBtn.disabled = true;
            createBtn.innerHTML = '<span class="loading-spinner"></span> Cr√©ation en cours...';
            
            try {
                // Utiliser service_role pour cr√©er le bucket
                const result = await presentationStorage.createBucket(true);
                
                if (result.success) {
                    showMessage('uploadStatus', `‚úÖ ${result.message}`, 'success');
                    document.getElementById('bucketSetupWarning').style.display = 'none';
                    
                    // Attendre un peu puis actualiser
                    setTimeout(async () => {
                        await checkBucketAndShowWarning();
                        await refreshPresentations();
                    }, 1000);
                } else {
                    // Si c'est une erreur de permissions/RLS, afficher des instructions d√©taill√©es
                    if (result.requiresManualCreation) {
                        const warningDiv = document.getElementById('bucketSetupWarning');
                        warningDiv.innerHTML = `
                            <div style="display: flex; align-items: start; gap: 10px;">
                                <i data-lucide="alert-triangle" style="width: 24px; height: 24px; color: #f87171; flex-shrink: 0;"></i>
                                <div style="flex: 1;">
                                    <p style="color: #f87171; font-weight: 600; margin-bottom: 8px;">${result.message}</p>
                                    <p style="color: var(--muted); font-size: 0.9em; margin-bottom: 15px;">
                                        ${result.details || 'Cr√©ez le bucket manuellement dans Supabase Dashboard.'}
                        ${result.errorDetails ? `<p style="color: var(--muted); font-size: 0.8em; margin-top: 10px; font-family: monospace; background: rgba(0,0,0,0.3); padding: 8px; border-radius: 4px;">D√©tails: ${result.errorDetails}</p>` : ''}
                                    </p>
                                    <div style="background: rgba(0, 0, 0, 0.2); padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                                        <p style="color: #fff; font-weight: 600; margin-bottom: 10px; font-size: 0.95em;">üìã Instructions √©tape par √©tape :</p>
                                        <ol style="color: var(--muted); font-size: 0.85em; line-height: 1.8; margin-left: 15px;">
                                            <li>Allez sur <a href="https://supabase.com/dashboard" target="_blank" style="color: var(--primary); font-weight: 600;">Supabase Dashboard</a></li>
                                            <li>Cliquez sur <strong>"Storage"</strong> dans le menu de gauche</li>
                                            <li>Cliquez sur <strong>"New bucket"</strong> (bouton en haut √† droite)</li>
                                            <li>Nom du bucket : <code style="background: rgba(255,255,255,0.1); padding: 2px 6px; border-radius: 4px; color: #fff;">presentations</code></li>
                                            <li>‚úÖ <strong>Cochez "Public bucket"</strong> (tr√®s important !)</li>
                                            <li>Cliquez sur <strong>"Create bucket"</strong></li>
                                        </ol>
                                        <p style="color: var(--muted); font-size: 0.8em; margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.1);">
                                            ‚ö†Ô∏è <strong>Important :</strong> Apr√®s la cr√©ation, allez dans l'onglet <strong>"Policies"</strong> du bucket et cr√©ez 3 policies :
                                            <ul style="margin-left: 15px; margin-top: 5px;">
                                                <li><strong>SELECT</strong> : Policy = <code>true</code></li>
                                                <li><strong>INSERT</strong> : Policy = <code>true</code></li>
                                                <li><strong>UPDATE</strong> : Policy = <code>true</code></li>
                                            </ul>
                                        </p>
                                    </div>
                                    <button onclick="checkBucketAndShowWarning(); refreshPresentations();" class="btn-secondary" style="width: auto; padding: 8px 16px; font-size: 0.9em; margin-top: 5px;">
                                        <i data-lucide="refresh-cw"></i>
                                        V√©rifier apr√®s cr√©ation
                                    </button>
                                </div>
                            </div>
                        `;
                        lucide.createIcons();
                    } else {
                        showMessage('uploadStatus', `‚ùå ${result.message}`, 'error');
                    }
                }
            } catch (error) {
                showMessage('uploadStatus', `‚ùå Erreur: ${error.message}`, 'error');
            } finally {
                createBtn.disabled = false;
                createBtn.innerHTML = originalText;
                lucide.createIcons();
            }
        }

        function updateUploadButton() {
            const name = document.getElementById('presentationName').value.trim();
            const file = document.getElementById('pptxFile').files[0];
            document.getElementById('uploadBtn').disabled = !(name && file);
        }

        async function uploadPresentation() {
            const name = document.getElementById('presentationName').value.trim();
            const file = document.getElementById('pptxFile').files[0];
            
            if (!name || !file) {
                showMessage('uploadStatus', 'Veuillez remplir tous les champs', 'error');
                return;
            }

            const uploadBtn = document.getElementById('uploadBtn');
            uploadBtn.disabled = true;
            uploadBtn.innerHTML = '<span class="loading-spinner"></span> T√©l√©chargement...';
            
            try {
                const result = await presentationStorage.uploadPresentation(file, name);
                showMessage('uploadStatus', `‚úÖ Pr√©sentation "${name}" t√©l√©charg√©e avec succ√®s!`, 'success');
                document.getElementById('presentationName').value = '';
                document.getElementById('pptxFile').value = '';
                updateUploadButton();
                await refreshPresentations();
            } catch (error) {
                console.error('Erreur upload:', error);
                
                // Si erreur RLS, afficher des instructions d√©taill√©es
                if (error.isRLSError) {
                    const statusDiv = document.getElementById('uploadStatus');
                    statusDiv.innerHTML = `
                        <div style="background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 8px; padding: 15px;">
                            <p style="color: #f87171; font-weight: 600; margin-bottom: 10px;">‚ùå Erreur de permissions RLS</p>
                            <p style="color: var(--muted); font-size: 0.9em; margin-bottom: 15px;">
                                Les policies du bucket "presentations" bloquent l'upload. Configurez les policies :
                            </p>
                            <div style="background: rgba(0, 0, 0, 0.2); padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                                <p style="color: #fff; font-weight: 600; margin-bottom: 10px; font-size: 0.95em;">üìã Configuration des Policies RLS :</p>
                                <ol style="color: var(--muted); font-size: 0.85em; line-height: 1.8; margin-left: 15px;">
                                    <li>Allez dans <a href="https://supabase.com/dashboard" target="_blank" style="color: var(--primary);">Supabase Dashboard</a></li>
                                    <li>Storage > <strong>presentations</strong> > Onglet <strong>"Policies"</strong></li>
                                    <li>Cliquez sur <strong>"New Policy"</strong></li>
                                    <li>S√©lectionnez <strong>"For full customization"</strong></li>
                                    <li>Cr√©ez 3 policies :
                                        <ul style="margin-left: 15px; margin-top: 5px;">
                                            <li><strong>Policy 1 - INSERT</strong> : Nom = "Allow public uploads", Operation = INSERT, Policy = <code style="background: rgba(255,255,255,0.1); padding: 2px 6px; border-radius: 4px;">true</code></li>
                                            <li><strong>Policy 2 - SELECT</strong> : Nom = "Allow public read", Operation = SELECT, Policy = <code style="background: rgba(255,255,255,0.1); padding: 2px 6px; border-radius: 4px;">true</code></li>
                                            <li><strong>Policy 3 - UPDATE</strong> : Nom = "Allow public update", Operation = UPDATE, Policy = <code style="background: rgba(255,255,255,0.1); padding: 2px 6px; border-radius: 4px;">true</code></li>
                                        </ul>
                                    </li>
                                    <li>Sauvegardez chaque policy</li>
                                </ol>
                            </div>
                            <button onclick="uploadPresentation()" class="btn-secondary" style="width: auto; padding: 8px 16px; font-size: 0.9em;">
                                <i data-lucide="refresh-cw"></i>
                                R√©essayer apr√®s configuration
                            </button>
                        </div>
                    `;
                    statusDiv.className = 'error-message';
                    statusDiv.style.display = 'block';
                } else {
                    showMessage('uploadStatus', `‚ùå Erreur: ${error.message}`, 'error');
                }
            } finally {
                uploadBtn.disabled = false;
                uploadBtn.innerHTML = '<i data-lucide="upload"></i> T√©l√©charger vers Supabase';
                lucide.createIcons();
            }
        }

        async function refreshPresentations() {
            try {
                presentations = await presentationStorage.listPresentations();
                
                // V√©rifier le statut de conversion pour chaque pr√©sentation
                for (let pres of presentations) {
                    pres.converted = await presentationStorage.isPresentationConverted(pres.presentationName);
                }
                
                displayPresentations();
                updatePresentationSelect();
            } catch (error) {
                console.error('Erreur lors du chargement des pr√©sentations:', error);
                const container = document.getElementById('presentationsList');
                const isBucketNotFound = error.message && error.message.includes('Bucket not found');
                const isPermissionError = error.message && error.message.includes('Permissions');
                
                container.innerHTML = `
                    <div style="text-align: center; padding: 30px; background: rgba(251, 191, 36, 0.1); border-radius: 12px; border: 2px solid rgba(251, 191, 36, 0.3);">
                        <i data-lucide="alert-triangle" style="width: 48px; height: 48px; margin: 0 auto 20px; color: #fbbf24;"></i>
                        <h3 style="color: #fbbf24; margin-bottom: 15px; font-size: 1.2em;">${isBucketNotFound ? 'Bucket non trouv√©' : isPermissionError ? 'Probl√®me de permissions' : 'Erreur lors du chargement'}</h3>
                        ${isBucketNotFound ? `
                            <div style="text-align: left; background: rgba(0, 0, 0, 0.2); padding: 20px; border-radius: 8px; margin: 20px 0;">
                                <p style="color: #fff; margin-bottom: 15px; font-weight: 600;">üìã Pour cr√©er le bucket "presentations" :</p>
                                <ol style="color: var(--muted); font-size: 0.9em; line-height: 1.8; margin-left: 20px;">
                                    <li>Allez sur <a href="https://supabase.com/dashboard" target="_blank" style="color: var(--primary);">Supabase Dashboard</a></li>
                                    <li>S√©lectionnez votre projet</li>
                                    <li>Allez dans <strong>"Storage"</strong> dans le menu de gauche</li>
                                    <li>Cliquez sur <strong>"New bucket"</strong></li>
                                    <li>Nom du bucket : <code style="background: rgba(255,255,255,0.1); padding: 2px 6px; border-radius: 4px;">presentations</code></li>
                                    <li>‚úÖ Cochez <strong>"Public bucket"</strong></li>
                                    <li>Cliquez sur <strong>"Create bucket"</strong></li>
                                </ol>
                                <p style="color: var(--muted); font-size: 0.85em; margin-top: 15px;">
                                    ‚ö†Ô∏è N'oubliez pas de configurer les policies RLS apr√®s la cr√©ation (voir PRESENTATION_SYSTEM.md)
                                </p>
                            </div>
                        ` : isPermissionError ? `
                            <div style="text-align: left; background: rgba(0, 0, 0, 0.2); padding: 20px; border-radius: 8px; margin: 20px 0;">
                                <p style="color: #fff; margin-bottom: 15px; font-weight: 600;">üîí Probl√®me de permissions RLS</p>
                                <p style="color: var(--muted); font-size: 0.9em; margin-bottom: 15px;">
                                    Le bucket existe mais les policies RLS bloquent la lecture. Configurez les policies :
                                </p>
                                <ol style="color: var(--muted); font-size: 0.9em; line-height: 1.8; margin-left: 20px;">
                                    <li>Allez dans Supabase Dashboard > Storage > <strong>presentations</strong></li>
                                    <li>Cliquez sur l'onglet <strong>"Policies"</strong></li>
                                    <li>Cr√©ez une policy <strong>"SELECT"</strong> avec la d√©finition : <code style="background: rgba(255,255,255,0.1); padding: 2px 6px; border-radius: 4px;">true</code></li>
                                    <li>Cr√©ez une policy <strong>"INSERT"</strong> avec la d√©finition : <code style="background: rgba(255,255,255,0.1); padding: 2px 6px; border-radius: 4px;">true</code></li>
                                </ol>
                            </div>
                        ` : `
                            <p style="color: var(--muted); font-size: 0.9em; margin-bottom: 15px;">
                                ${error.message || 'Une erreur est survenue'}
                            </p>
                            <p style="color: var(--muted); font-size: 0.85em;">
                                üí° Si vous voyez vos fichiers dans Supabase mais pas ici, v√©rifiez :
                                <ul style="text-align: left; margin-top: 10px; margin-left: 20px;">
                                    <li>Les policies RLS du bucket</li>
                                    <li>Que les fichiers sont dans le dossier <code>pptx/</code></li>
                                    <li>La console du navigateur pour plus de d√©tails</li>
                                </ul>
                            </p>
                        `}
                        <button onclick="refreshPresentations()" class="btn-secondary" style="width: auto; margin-top: 15px;">
                            <i data-lucide="refresh-cw"></i>
                            R√©essayer
                        </button>
                    </div>
                `;
                lucide.createIcons();
            }
        }

        function displayPresentations() {
            const container = document.getElementById('presentationsList');
            
            if (presentations.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 30px; background: rgba(255, 255, 255, 0.03); border-radius: 12px; border: 2px dashed rgba(255, 255, 255, 0.1);">
                        <i data-lucide="folder-plus" style="width: 48px; height: 48px; margin: 0 auto 20px; color: var(--muted);"></i>
                        <p style="color: var(--muted); margin-bottom: 15px; font-size: 1.1em;">Aucune pr√©sentation trouv√©e</p>
                        <p style="color: var(--muted); font-size: 0.9em; margin-bottom: 20px;">
                            Si vous venez de cr√©er le bucket "presentations", attendez quelques secondes puis actualisez.
                        </p>
                        <button onclick="refreshPresentations()" class="btn-secondary" style="width: auto;">
                            <i data-lucide="refresh-cw"></i>
                            Actualiser
                        </button>
                    </div>
                `;
                lucide.createIcons();
                return;
            }

            container.innerHTML = presentations.map(pres => {
                const isSelected = selectedPresentation && selectedPresentation.fileName === pres.fileName;
                return `
                    <div class="presentation-item ${isSelected ? 'selected' : ''}" onclick="selectPresentation('${pres.fileName}')">
                        <h3>${pres.presentationName}</h3>
                        <p style="color: var(--muted); font-size: 0.9em; margin-bottom: 10px;">
                            ${new Date(pres.uploadDate).toLocaleDateString('fr-FR')}
                        </p>
                        <span class="status ${pres.converted ? 'ready' : 'pending'}" id="status-${pres.fileName}">
                            ${pres.converted ? '‚úÖ Pr√™t' : '‚è≥ En attente'}
                        </span>
                    </div>
                `;
            }).join('');
        }

        async function selectPresentation(fileName) {
            const pres = presentations.find(p => p.fileName === fileName);
            if (!pres) return;

            selectedPresentation = pres;
            displayPresentations();
            
            // V√©rifier si convertie
            const isConverted = await presentationStorage.isPresentationConverted(pres.presentationName);
            pres.converted = isConverted;
            
            document.getElementById('convertBtn').disabled = isConverted;
            
            // Mettre √† jour le statut
            const statusEl = document.getElementById(`status-${fileName}`);
            if (statusEl) {
                statusEl.className = `status ${isConverted ? 'ready' : 'pending'}`;
                statusEl.textContent = isConverted ? '‚úÖ Pr√™t' : '‚è≥ En attente';
            }
        }

        async function convertPresentation() {
            if (!selectedPresentation) {
                showMessage('convertStatus', 'Veuillez s√©lectionner une pr√©sentation', 'error');
                return;
            }

            const convertBtn = document.getElementById('convertBtn');
            convertBtn.disabled = true;
            convertBtn.innerHTML = '<span class="loading-spinner"></span> Conversion en cours...';
            
            try {
                // Appeler l'API de conversion
                const response = await fetch(`${API_URL}/convert`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        presentationName: selectedPresentation.presentationName,
                        pptxUrl: selectedPresentation.url
                    })
                });

                const result = await response.json();
                
                if (!response.ok) {
                    throw new Error(result.error || 'Erreur lors de la conversion');
                }

                showMessage('convertStatus', `‚úÖ ${result.message}`, 'success');
                selectedPresentation.converted = true;
                displayPresentations();
                document.getElementById('convertBtn').disabled = true;
                document.getElementById('startBtn').disabled = false;
                
            } catch (error) {
                showMessage('convertStatus', `‚ùå Erreur: ${error.message}`, 'error');
            } finally {
                convertBtn.disabled = false;
                convertBtn.innerHTML = '<i data-lucide="image"></i> Convertir en Images';
                lucide.createIcons();
            }
        }

        function updatePresentationSelect() {
            // Plus besoin de cette fonction, on charge directement depuis le dossier local
        }

        async function startPresentation() {
            // Charger les slides directement depuis le dossier Final
            slides = await loadSlidesFromLocal();
            
            if (slides.length === 0) {
                showMessage('convertStatus', 'Aucune slide trouv√©e dans le dossier Final', 'error');
                return;
            }

            // Afficher l'√©cran de login
            document.getElementById('managementScreen').style.display = 'none';
            document.getElementById('loginScreen').style.display = 'flex';
        }

        async function loadSlidesFromLocal() {
            // Liste des images dans le dossier Final (tri√©es par timestamp)
            const imageFiles = [
                'Screenshot 2025-12-01 213600.png',
                'Screenshot 2025-12-01 213609.png',
                'Screenshot 2025-12-01 213617.png',
                'Screenshot 2025-12-01 213627.png',
                'Screenshot 2025-12-01 213637.png',
                'Screenshot 2025-12-01 213645.png',
                'Screenshot 2025-12-01 213655.png',
                'Screenshot 2025-12-01 213702.png',
                'Screenshot 2025-12-01 213711.png',
                'Screenshot 2025-12-01 213722.png',
                'Screenshot 2025-12-01 213739.png',
                'Screenshot 2025-12-01 213750.png',
                'Screenshot 2025-12-01 213804.png',
                'Screenshot 2025-12-01 213813.png',
                'Screenshot 2025-12-01 213825.png',
                'Screenshot 2025-12-01 213833.png',
                'Screenshot 2025-12-01 213844.png',
                'Screenshot 2025-12-01 213853.png'
            ];

            // Cr√©er les URLs des slides
            return imageFiles.map((fileName, index) => ({
                name: fileName,
                url: `presentation-slides/Final/${fileName}`,
                index: index + 1
            }));
        }

        function checkAccess() {
            const code = document.getElementById('accessCode').value;
            const errorMsg = document.getElementById('errorMessage');
            
            if (code === ADMIN_ACCESS_CODE) {
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('presentationScreen').style.display = 'flex';
                loadPresentation();
            } else {
                errorMsg.style.display = 'block';
                document.getElementById('accessCode').value = '';
                document.getElementById('accessCode').focus();
            }
        }

        async function loadPresentation() {
            const slideContainer = document.getElementById('slideContainer');
            
            if (slides.length === 0) {
                slideContainer.innerHTML = `
                    <div class="no-slides">
                        <h2>‚ö†Ô∏è Aucune slide trouv√©e</h2>
                        <p>V√©rifiez que les images sont pr√©sentes dans le dossier <code>presentation-slides/Final/</code></p>
                    </div>
                `;
                document.getElementById('totalSlides').textContent = '0';
                return;
            }

            document.getElementById('totalSlides').textContent = slides.length;
            showSlide(0);
            lucide.createIcons();
        }

        function showSlide(index) {
            if (index < 0 || index >= slides.length) return;
            
            currentSlideIndex = index;
            const slideContainer = document.getElementById('slideContainer');
            
            const img = document.createElement('img');
            img.src = slides[index].url;
            img.alt = `Slide ${index + 1}`;
            img.className = 'slide-image';
            
            // Ajouter le clic pour naviguer en mode plein √©cran
            img.addEventListener('click', () => {
                const isFullscreen = !!(document.fullscreenElement || document.webkitFullscreenElement || 
                                       document.mozFullScreenElement || document.msFullscreenElement);
                if (isFullscreen) {
                    nextSlide();
                }
            });
            
            slideContainer.innerHTML = '';
            slideContainer.appendChild(img);
            
            document.getElementById('currentSlide').textContent = index + 1;
            
            document.getElementById('prevBtn').disabled = index === 0;
            document.getElementById('nextBtn').disabled = index === slides.length - 1;
        }

        function nextSlide() {
            if (currentSlideIndex < slides.length - 1) {
                showSlide(currentSlideIndex + 1);
            }
        }

        function previousSlide() {
            if (currentSlideIndex > 0) {
                showSlide(currentSlideIndex - 1);
            }
        }

        function exitPresentation() {
            // Sortir du mode plein √©cran si actif
            if (document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement || document.msFullscreenElement) {
                exitFullscreen();
            }
            
            if (confirm('√ätes-vous s√ªr de vouloir quitter la pr√©sentation ?')) {
                document.getElementById('presentationScreen').style.display = 'none';
                document.getElementById('managementScreen').style.display = 'flex';
                document.getElementById('accessCode').value = '';
            }
        }

        function toggleFullscreen() {
            const presentationScreen = document.getElementById('presentationScreen');
            
            if (!document.fullscreenElement && !document.webkitFullscreenElement && 
                !document.mozFullScreenElement && !document.msFullscreenElement) {
                // Entrer en mode plein √©cran
                presentationScreen.classList.add('fullscreen');
                
                if (presentationScreen.requestFullscreen) {
                    presentationScreen.requestFullscreen();
                } else if (presentationScreen.webkitRequestFullscreen) {
                    presentationScreen.webkitRequestFullscreen();
                } else if (presentationScreen.mozRequestFullScreen) {
                    presentationScreen.mozRequestFullScreen();
                } else if (presentationScreen.msRequestFullscreen) {
                    presentationScreen.msRequestFullscreen();
                }
            } else {
                // Sortir du mode plein √©cran
                exitFullscreen();
            }
        }

        function exitFullscreen() {
            const presentationScreen = document.getElementById('presentationScreen');
            presentationScreen.classList.remove('fullscreen');
            
            if (document.exitFullscreen) {
                document.exitFullscreen();
            } else if (document.webkitExitFullscreen) {
                document.webkitExitFullscreen();
            } else if (document.mozCancelFullScreen) {
                document.mozCancelFullScreen();
            } else if (document.msExitFullscreen) {
                document.msExitFullscreen();
            }
        }

        function updateFullscreenButton() {
            const isFullscreen = !!(document.fullscreenElement || document.webkitFullscreenElement || 
                                   document.mozFullScreenElement || document.msFullscreenElement);
            const presentationScreen = document.getElementById('presentationScreen');
            
            if (isFullscreen) {
                presentationScreen.classList.add('fullscreen');
            } else {
                presentationScreen.classList.remove('fullscreen');
            }
            
            const icon = document.getElementById('fullscreenIcon');
            const text = document.getElementById('fullscreenText');
            
            if (isFullscreen) {
                icon.setAttribute('data-lucide', 'minimize');
                text.textContent = 'Quitter plein √©cran';
            } else {
                icon.setAttribute('data-lucide', 'maximize');
                text.textContent = 'Plein √©cran';
            }
            lucide.createIcons();
        }

        // √âcouter les changements de mode plein √©cran
        document.addEventListener('fullscreenchange', updateFullscreenButton);
        document.addEventListener('webkitfullscreenchange', updateFullscreenButton);
        document.addEventListener('mozfullscreenchange', updateFullscreenButton);
        document.addEventListener('MSFullscreenChange', updateFullscreenButton);

        // Navigation au clavier
        document.addEventListener('keydown', (e) => {
            if (document.getElementById('presentationScreen').style.display === 'none') return;
            
            switch(e.key) {
                case 'ArrowRight':
                case ' ':
                    e.preventDefault();
                    nextSlide();
                    break;
                case 'ArrowLeft':
                    e.preventDefault();
                    previousSlide();
                    break;
                case 'Escape':
                    e.preventDefault();
                    // Si en plein √©cran, sortir du plein √©cran d'abord
                    if (document.fullscreenElement || document.webkitFullscreenElement || 
                        document.mozFullScreenElement || document.msFullscreenElement) {
                        exitFullscreen();
                    } else {
                        exitPresentation();
                    }
                    break;
                case 'f':
                case 'F':
                    // Toggle plein √©cran avec la touche F
                    if (e.target.tagName !== 'INPUT') {
                        e.preventDefault();
                        toggleFullscreen();
                    }
                    break;
            }
        });

        function showMessage(elementId, message, type) {
            const el = document.getElementById(elementId);
            el.textContent = message;
            el.className = type === 'error' ? 'error-message' : 'success-message';
            el.style.display = 'block';
            
            setTimeout(() => {
                el.style.display = 'none';
            }, 5000);
        }

        async function diagnoseBucket() {
            const statusDiv = document.getElementById('presentationsList');
            statusDiv.innerHTML = '<p style="text-align: center; color: var(--muted);">üîç Diagnostic en cours...</p>';
            
            try {
                // Lister tous les buckets disponibles
                const allBuckets = await presentationStorage.listAllBuckets();
                
                // V√©rifier si le bucket existe
                const bucketExists = await presentationStorage.checkBucketExists();
                
                let report = `
                    <div style="text-align: left; background: rgba(0, 0, 0, 0.2); padding: 20px; border-radius: 8px;">
                        <h3 style="color: #fff; margin-bottom: 15px;">üìä Rapport de Diagnostic</h3>
                        <div style="color: var(--muted); font-size: 0.9em; line-height: 1.8;">
                            <p><strong>Bucket "presentations" :</strong> ${bucketExists ? '‚úÖ Existe' : '‚ùå Non trouv√©'}</p>
                            
                            ${allBuckets.length > 0 ? `
                                <p style="margin-top: 15px;"><strong>Buckets disponibles dans Supabase :</strong></p>
                                <ul style="margin-left: 20px; margin-top: 5px;">
                                    ${allBuckets.map(b => `<li><code style="background: rgba(255,255,255,0.1); padding: 2px 6px; border-radius: 4px;">${b.name}</code> ${b.public ? '(Public)' : '(Priv√©)'}</li>`).join('')}
                                </ul>
                            ` : '<p style="margin-top: 10px; color: #fbbf24;">‚ö†Ô∏è Aucun bucket trouv√© dans Supabase</p>'}
                `;
                
                if (bucketExists) {
                    // Essayer de lister les fichiers
                    try {
                        const files = await presentationStorage.listPresentations();
                        report += `
                            <p style="margin-top: 15px;"><strong>Fichiers trouv√©s :</strong> ${files.length}</p>
                            ${files.length > 0 ? `
                                <p style="margin-top: 10px;"><strong>Fichiers :</strong></p>
                                <ul style="margin-left: 20px; margin-top: 5px;">
                                    ${files.map(f => `<li>${f.fileName}</li>`).join('')}
                                </ul>
                            ` : '<p style="color: #fbbf24; margin-top: 10px;">‚ö†Ô∏è Aucun fichier trouv√©. V√©rifiez les policies RLS.</p>'}
                        `;
                    } catch (listError) {
                        report += `<p style="color: #f87171; margin-top: 10px;"><strong>Erreur lors de la liste :</strong> ${listError.message}</p>`;
                    }
                } else {
                    report += `
                        <div style="background: rgba(251, 191, 36, 0.1); padding: 15px; border-radius: 8px; margin-top: 15px; border: 1px solid rgba(251, 191, 36, 0.3);">
                            <p style="color: #fbbf24; margin-bottom: 10px; font-weight: 600;">üìã Pour cr√©er le bucket "presentations" :</p>
                            <div style="margin-bottom: 15px;">
                                <button onclick="createBucket()" class="btn-success" style="width: auto; padding: 10px 20px;">
                                    <i data-lucide="plus-circle"></i>
                                    Cr√©er automatiquement
                                </button>
                            </div>
                            <p style="color: var(--muted); font-size: 0.85em; margin-bottom: 10px;">OU cr√©ez-le manuellement :</p>
                            <ol style="margin-left: 20px; line-height: 2; font-size: 0.9em;">
                                <li>Allez sur <a href="https://supabase.com/dashboard" target="_blank" style="color: var(--primary);">Supabase Dashboard</a></li>
                                <li>S√©lectionnez votre projet</li>
                                <li>Allez dans <strong>"Storage"</strong> dans le menu de gauche</li>
                                <li>Cliquez sur <strong>"New bucket"</strong></li>
                                <li>Nom du bucket : <code style="background: rgba(255,255,255,0.1); padding: 2px 6px; border-radius: 4px;">presentations</code></li>
                                <li>‚úÖ Cochez <strong>"Public bucket"</strong></li>
                                <li>Cliquez sur <strong>"Create bucket"</strong></li>
                            </ol>
                            <p style="color: var(--muted); font-size: 0.85em; margin-top: 10px;">
                                ‚ö†Ô∏è Apr√®s la cr√©ation, configurez les policies RLS (SELECT, INSERT, UPDATE) avec la d√©finition <code>true</code>
                            </p>
                        </div>
                    `;
                }
                
                report += `
                        </div>
                        <div style="margin-top: 20px; display: flex; gap: 10px;">
                            <button onclick="refreshPresentations()" class="btn-secondary" style="width: auto;">
                                <i data-lucide="refresh-cw"></i>
                                Actualiser
                            </button>
                            <button onclick="diagnoseBucket()" class="btn-secondary" style="width: auto;">
                                <i data-lucide="search"></i>
                                Re-diagnostic
                            </button>
                        </div>
                    </div>
                `;
                
                statusDiv.innerHTML = report;
                lucide.createIcons();
            } catch (error) {
                statusDiv.innerHTML = `
                    <div style="text-align: center; padding: 20px; background: rgba(239, 68, 68, 0.1); border-radius: 8px;">
                        <p style="color: #f87171;">Erreur lors du diagnostic: ${error.message}</p>
                        <button onclick="diagnoseBucket()" class="btn-secondary" style="width: auto; margin-top: 15px;">
                            <i data-lucide="refresh-cw"></i>
                            R√©essayer
                        </button>
                    </div>
                `;
        lucide.createIcons();
            }
        }
    </script>
</body>
</html>
